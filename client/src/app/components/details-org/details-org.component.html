<div>
  <mat-toolbar>
    <span>Organization details</span>
    <span class="fill-remaining-space"></span>
    
    <a routerLink="/activeOrg">
      <button mat-raised-button color="primary">
        Back
        <i class="material-icons">forward</i>
      </button>
    </a>
  </mat-toolbar>  
</div>

<mat-tab-group (selectedTabChange)="tabClick($event)" >
  <mat-tab label="Information" *ngIf="myOrg">
    <mat-card class="example-card">
      <mat-card-header>
      </mat-card-header>
      <mat-card-content>
        <mat-grid-list cols="4" rowHeight="60px">
            <mat-grid-tile [colspan]=1 [rowspan]=6 class="matGridList-figure">
              <mat-card class="card-logo">
                <mat-card-content class="card-logo-content">
                    <img *ngIf="!myOrg.contacts.logo" src='https://img.icons8.com/metro/100/000000/organization.png' />
                    <img *ngIf="myOrg.contacts.logo.indexOf('http://') == 0 || myOrg.contacts.logo.indexOf('https://') == 0" src='{{myOrg.contacts.logo}}' onError="this.src='https://img.icons8.com/metro/100/000000/organization.png'"/>
                    <img *ngIf="myOrg.contacts.logo && myOrg.contacts.logo.indexOf('http://') != 0 && myOrg.contacts.logo.indexOf('https://') != 0" src='http://{{myOrg.contacts.logo}}' onError="this.src='https://img.icons8.com/metro/100/000000/organization.png'"/>
                </mat-card-content>
              </mat-card>
            </mat-grid-tile>
            <mat-grid-tile [colspan]=2 [rowspan]=6 class="matGridList-figure">
              <mat-list role="list">
                <mat-list-item role="listitem"><h2>{{myOrg.name}}</h2></mat-list-item>
                <mat-list-item role="listitem"><p>{{myOrg.description}}</p></mat-list-item>
                <mat-list-item role="listitem">
                  <i class="material-icons">more</i>&nbsp;
                  <mat-chip-list>
                      <mat-chip *ngFor="let tag of myOrg.tag">{{tag}}</mat-chip>
                  </mat-chip-list>
                  
                </mat-list-item>
                <mat-list-item role="listitem">
                  <i class="material-icons">web</i>&nbsp;
                  <a *ngIf="myOrg.contacts.web.indexOf('http://') == 0 || myOrg.contacts.web.indexOf('https://') == 0; else addHttp" 
                      href="{{myOrg.contacts.web}}" target="_blank">{{myOrg.contacts.web}}</a>
                  <ng-template #addHttp>
                    <a href="http://{{myOrg.contacts.web}}" target="_blank">{{myOrg.contacts.web}}</a>
                  </ng-template>
                </mat-list-item>
                <mat-list-item role="listitem">
                  <i class="material-icons">phone</i>&nbsp;
                  <mat-chip-list>
                      <mat-chip *ngFor="let phone of myOrg.contacts.phone">{{phone}}</mat-chip>
                  </mat-chip-list>
                </mat-list-item>
              </mat-list>
            </mat-grid-tile>
            <mat-grid-tile [colspan]=1 [rowspan]=1 class="matGridList-figure">
              <button mat-raised-button color="primary" style="max-height:40px !important" *ngIf="userRights && (userRights.admin == true || userRights.ownedOrganizations.includes(myOrg.id))" (click)="openDialog4ModifyOrg()">
                <mat-icon matSuffix>mode_edit</mat-icon>
                Edit organization information
              </button>
            </mat-grid-tile>
            <mat-grid-tile [colspan]=1 [rowspan]=5 class="matGridList-infoBelow" rowHeight="60px"></mat-grid-tile>
            <mat-grid-tile [colspan]=1 [rowspan]=1 class="matGridList-infoBelow" rowHeight="60px">Domain</mat-grid-tile>
            <mat-grid-tile [colspan]=3 [rowspan]=1 class="matGridList-infoBelow" rowHeight="60px">{{myOrg.slug}}</mat-grid-tile>

            <mat-grid-tile [colspan]=1 [rowspan]=1 class="matGridList-infoBelow" rowHeight="60px">Contact</mat-grid-tile>
            <mat-grid-tile [colspan]=3 [rowspan]=1 class="matGridList-infoBelow" rowHeight="60px">
              {{myOrg.contacts.name}}
              {{myOrg.contacts.surname}}<br/>
              ({{myOrg.contacts.email}})
            </mat-grid-tile>
        </mat-grid-list>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab label="Configuration" *ngIf="userRights && (userRights.admin == true || userRights.ownedOrganizations.includes(myOrg.id))">
    <mat-card class="example-card">
      <mat-card-header>
        <mat-card-title>{{orgName}}</mat-card-title>
        <mat-card-subtitle>List of components in the organization</mat-card-subtitle>
        <span class="fill-remaining-space"></span>
        <button mat-raised-button color="primary" style="max-height:40px !important" *ngIf="userRights && userRights.admin == true" (click)="openDialog4ManageComponent()">
          <mat-icon matSuffix>mode_edit</mat-icon>
          Manage components
        </button>&nbsp;
      </mat-card-header>
      <mat-card-content>
        <mat-accordion>
          <mat-expansion-panel *ngFor="let component of activatedComponents">
            <mat-expansion-panel-header>
              <mat-panel-title>
                {{component.componentId}}
              </mat-panel-title>
            </mat-expansion-panel-header>
            <mat-list>
              <mat-list-item *ngFor="let tenant of component.tenants; let la=last">
                {{tenant}}
                <mat-divider *ngIf="!la"></mat-divider>
              </mat-list-item>
            </mat-list>
          </mat-expansion-panel>
        </mat-accordion>
      </mat-card-content>
    </mat-card>
  </mat-tab>
  <mat-tab label="Users" *ngIf="userRights && (userRights.admin == true || userRights.ownedOrganizations.includes(myOrg.id))">
    <mat-card class="example-card">
      <mat-card-header>
        <mat-card-title>{{orgName}}</mat-card-title>
        <mat-card-subtitle>List of users in the organization</mat-card-subtitle>
        <span class="fill-remaining-space"></span>
        <button mat-raised-button color="primary" style="max-height:40px !important" *ngIf="userRights && (userRights.admin == true || userRights.ownedOrganizations.includes(myOrg.id))" (click)="openDialog4AddUser()">
          <i class="material-icons">add_circle_outline</i>
          Add user
        </button>
      </mat-card-header>
      <mat-card-content>
          <mat-table #table [dataSource]="dataSourceUser">
            <!-- Name Column -->
            <ng-container matColumnDef="username">
              <mat-header-cell *matHeaderCellDef> Username </mat-header-cell>
              <mat-cell *matCellDef="let element"> {{element.username}} </mat-cell>
            </ng-container>
        
            <!-- Domain Column -->
            <ng-container matColumnDef="roles">
              <mat-header-cell *matHeaderCellDef> Roles </mat-header-cell>
              <!-- <mat-cell *matCellDef="let element"> {{element.roles['0'].role}}  </mat-cell>-->
              <mat-cell *matCellDef="let element"> 
                <button mat-button color="primary" (click)="openDialog4DetailsRole(element.id,element.username)">
                    See roles
                </button>
              </mat-cell>
            </ng-container>
        
            <!-- owner Column -->
            <ng-container matColumnDef="owner">
              <mat-header-cell *matHeaderCellDef> Owner </mat-header-cell>
              <mat-cell *matCellDef="let element"> {{element.owner}} </mat-cell>
            </ng-container>
      
            <!-- Status Column -->
            <ng-container matColumnDef="action">
              <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
              <mat-cell *matCellDef="let element"> 
                <button mat-button (click)="openDialog4ModifyUser(element.username)"><mat-icon matSuffix>mode_edit</mat-icon></button>
                <button mat-button *ngIf="userRights && (userRights.admin == true || userRights.ownedOrganizations.includes(myOrg.id))" (click)="openDialog4DeleteUser(element.id)"><mat-icon matSuffix>delete</mat-icon></button>
              </mat-cell>
            </ng-container>
      
            <mat-header-row *matHeaderRowDef="displayedUsersColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedUsersColumns;"></mat-row>
          </mat-table>
      </mat-card-content>
    </mat-card>
  </mat-tab>
</mat-tab-group>